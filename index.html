<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistert Selvhjelp Demo</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background-color: #f4f7f6; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        textarea { width: 100%; height: 300px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical; }
        button { background-color: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        button:hover { background-color: #0056b3; }
        #status { margin-top: 15px; font-weight: bold; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>

    <h1>Oversettelse Demo (Auto-Detect)</h1>

    <div class="card">
        <label>API Nøkkel:</label>
        <input type="text" id="apiKey" value="83dcebb3-5c3e-4843-9124-1c4d05f002c8:fx">
    </div>

    <div class="card">
        <h3>Norsk Tekst</h3>
        <textarea id="sourceText">Hva er depresjon?

Det er helt normalt å føle seg nedfor, trist eller deppa innimellom, og sorg er en naturlig reaksjon når vi mister noe eller noen som betyr mye for oss. Depresjon er ikke det samme som å føle seg nedfor.

Depresjon er en psykisk lidelse som påvirker hva du føler, tenker og gjør over en lang periode. Det er en tilstand preget av nedstemthet, lav selvfølelse og mindre interesse for aktiviteter som tidligere gav glede. Du kan også føle deg nedtrykt, sint og irritabel, eller tom for energi. Noen får også konsentrasjonsproblemer og husker dårligere.

... heldigvis er det veldig gode muligheter for å bli frisk igjen.</textarea>
        
        <button onclick="translateText()" id="btn">Oversett til Engelsk</button>
        <p id="status"></p>
    </div>

    <div class="card">
        <h3>Engelsk Resultat</h3>
        <textarea id="targetText" readonly></textarea>
    </div>

    <script>
        // Denne funksjonen kjøres når du trykker på knappen
        async function translateText() {
            console.log("Knapp trykket! Starter oversettelse..."); // Sjekk konsollen (F12) for denne beskjeden
            
            const apiKey = document.getElementById('apiKey').value;
            const text = document.getElementById('sourceText').value;
            const statusEl = document.getElementById('status');
            const targetEl = document.getElementById('targetText');
            const btn = document.getElementById('btn');

            statusEl.innerText = "Jobber...";
            statusEl.style.color = "blue";
            btn.disabled = true;

            // Proxy brukes for å unngå CORS-feil lokalt
            const deepLUrl = "https://api-free.deepl.com/v2/translate";
            const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(deepLUrl);

            try {
                const params = new URLSearchParams();
                params.append('auth_key', apiKey);
                params.append('text', text);
                // VIKTIG: Vi har fjernet 'source_lang' helt. 
                // DeepL skjønner automatisk at det er norsk.
                params.append('target_lang', 'EN-GB'); 

                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: params
                });

                if (!response.ok) {
                    const err = await response.text();
                    throw new Error(err); // Kaster feilmeldingen videre til catch-blokken
                }

                const data = await response.json();
                
                if (data.translations && data.translations.length > 0) {
                    targetEl.value = data.translations[0].text;
                    statusEl.innerText = "Suksess!";
                    statusEl.style.color = "green";
                } else {
                    statusEl.innerText = "Fikk svar, men ingen oversettelse.";
                }

            } catch (error) {
                console.error("Noe gikk galt:", error);
                statusEl.innerText = "Feil: " + error.message;
                statusEl.style.color = "red";
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
